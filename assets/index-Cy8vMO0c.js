import{j as e,r as g}from"./index-w9WTeD3s.js";import{s as f,N as u,g as C,S as $,a as O}from"./index-BTuoQVpP.js";const E=["E","B","G","D","A","E"],G=[4,3,3,3,2,2],Q=({onNoteClick:d,isHideNoteName:p=!1,fretRange:x=5})=>{const j=Array.from({length:x+1},(t,s)=>s),y=(t,s,a)=>{const o=u.indexOf(t)+a,i=o%12,h=Math.floor(o/12),N=u[i],c=`${N}${s+h}`;return{noteName:N,fullNote:c}},b=async(t,s)=>{await f.initialize(),f.playNotes([t],"8n"),d?.({name:t,note:s})};return e.jsx("div",{className:"guitar-pattern-container",children:e.jsx("div",{className:"guitar-pattern",children:E.map((t,s)=>{const a=G[s];return e.jsx("div",{className:"guitar-string",children:j.map(l=>{const{noteName:o,fullNote:i}=y(t,a,l),h=l===0;return e.jsx("div",{className:`fret ${h?"is-root":""}`,children:e.jsx("button",{className:"fret-button",title:`String ${s+1}, Fret ${l} (${i})`,onClick:()=>b(i,o),children:!p&&o})},`s${s}-f${l}`)})},`string-${s}`)})})})},_=d=>{const p=d.match(/^([A-G]#?)(\d+)$/);if(!p)return null;const x=p[1];return u.includes(x)?{note:x,octave:parseInt(p[2],10)}:null},F=({onNoteClick:d,isHideNoteName:p=!1,startKey:x="E2",endKey:j="G5"})=>{const b=(()=>{const s=[],a=_(x),l=_(j);if(!a||!l)return[];const o=a.octave,i=l.octave,h=a.note,N=l.note;for(let c=o;c<=i;c++)for(const m of u){if(m.includes("#")||c===o&&u.indexOf(m)<u.indexOf(h)||c===i&&u.indexOf(m)>u.indexOf(N))continue;const S=(u.indexOf(m)+1)%12,k=u[S];let w=!1;k.includes("#")&&(c===i&&m===N||(w=!0)),s.push({noteName:m,octave:c,fullNote:`${m}${c}`,isBlack:!1,hasSharp:w})}return s})(),t=async(s,a)=>{await f.initialize(),f.playNotes([s],"8n"),d?.({note:s,name:a})};return e.jsx("div",{className:"piano-container",children:e.jsx("div",{className:"piano",children:b.map(s=>{const a=`${s.noteName}#`,l=`${a}${s.octave}`;return e.jsxs("div",{className:"key-group",children:[e.jsx("div",{className:"white-key",onClick:()=>t(s.fullNote,s.noteName),children:e.jsx("span",{className:"key-label",children:!p&&s.fullNote})}),s.hasSharp&&e.jsx("div",{className:"black-key",onClick:()=>t(l,a)})]},s.fullNote)})})})},T=()=>{const[d,p]=g.useState("easy"),[x,j]=g.useState("piano"),[y,b]=g.useState("show"),[t,s]=g.useState(C()),[a,l]=g.useState([]),[o,i]=g.useState("idle"),h=n=>{p(n);const r=n==="easy"?C():O();s(r),l([]),i("idle")},N=async()=>{await f.initialize(),c()},c=()=>{f.playNotes(t.notes,"2n")},m=n=>{o==="correct"||o==="revealed"||(d==="easy"?l([n]):a.includes(n)?l(r=>r.filter(v=>v!==n)):l(r=>[...r,n]))},z=()=>{if(a.length===0)return;const n=t.notes.map(v=>v.slice(0,-1)),r=a.length===n.length&&a.every(v=>n.includes(v));i(r?"correct":"wrong")},S=()=>{const n=d==="easy"?C():O();s(n),l([]),i("idle"),setTimeout(()=>f.playNotes(n.notes,"2n"),500)},k=()=>{if(a.length===0)return;const n=a.map(r=>`${r}4`);f.playNotes(n,"2n")},w=()=>{i("revealed");const n=t.notes.map(r=>r.slice(0,-1));l(n),f.playNotes(t.notes,"2n")};return e.jsxs("div",{className:"space-y-6 mx-auto p-4 sm:p-6 text-foreground",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-6",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"音感訓練"}),e.jsx("p",{className:"opacity-60 mt-1",children:"聽辨音程與和弦練習"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full sm:w-auto",children:[e.jsx($,{value:d,onChange:h,options:[{value:"easy",label:"單音"},{value:"hard",label:"和弦"}],size:"sm"}),e.jsx($,{value:x,onChange:j,options:[{value:"guitar",label:"吉他",icon:e.jsx("span",{className:"material-icons",style:{fontSize:"16px"},children:"music_note"})},{value:"piano",label:"鋼琴",icon:e.jsx("span",{className:"material-icons",style:{fontSize:"16px"},children:"grid_view"})}],size:"sm"}),e.jsx($,{value:y,onChange:b,options:[{value:"show",label:"顯示",icon:e.jsx("span",{className:"material-icons",style:{fontSize:"16px"},children:"visibility"})},{value:"hide",label:"隱藏",icon:e.jsx("span",{className:"material-icons",style:{fontSize:"16px"},children:"visibility_off"})}],size:"sm"})]})]}),e.jsxs("div",{className:"flex flex-col items-center justify-center py-4",children:[e.jsx("button",{onClick:N,title:"播放題目",className:"w-20 h-20 md:w-24 md:h-24 bg-foreground text-background rounded-full flex items-center justify-center hover:scale-105 active:scale-95 transition-all shadow-lg",children:e.jsx("span",{className:"material-icons",style:{fontSize:"32px"},children:"volume_up"})}),e.jsx("div",{className:"mt-4 opacity-50 text-sm font-medium",children:"點擊播放"}),e.jsx("div",{className:"mt-6 w-full max-w-lg px-2",children:e.jsx("div",{className:`
            text-center p-4 rounded-lg border transition-all duration-300 flex flex-col sm:flex-row items-center justify-center gap-3
            ${o==="correct"?"bg-green-500/10 border-green-500/20 text-green-600 dark:text-green-400":o==="wrong"?"bg-red-500/10 border-red-500/20 text-red-600 dark:text-red-400":o==="revealed"?"bg-yellow-500/10 border-yellow-500/20 text-yellow-600 dark:text-yellow-400":"border-border opacity-60"}
          `,children:o==="correct"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-icons hidden sm:block",style:{fontSize:"20px"},children:"check_circle"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium text-sm sm:text-base",children:["正確！答案是 ",t.root," ",t.type!=="單音"?t.type:""]}),t.type!=="單音"&&e.jsxs("span",{className:"text-xs opacity-80 mt-1",children:["組成音: ",t.notes.map(n=>n.slice(0,-1)).join(", ")]})]})]}):o==="wrong"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-icons hidden sm:block",style:{fontSize:"20px"},children:"cancel"}),e.jsx("span",{className:"font-medium text-sm sm:text-base",children:"答案不對，再試試看"})]}):o==="revealed"?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-icons hidden sm:block",style:{fontSize:"20px"},children:"help"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"font-medium text-sm sm:text-base",children:["正確答案是 ",t.root," ",t.type!=="單音"?t.type:""]}),t.type!=="單音"&&e.jsxs("span",{className:"text-xs opacity-80 mt-1",children:["組成音: ",t.notes.map(n=>n.slice(0,-1)).join(", ")]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"material-icons hidden sm:block",style:{fontSize:"20px"},children:"music_note"}),e.jsx("span",{className:"text-sm sm:text-base",children:"請聽題目並在下方選出答案"})]})})})]}),e.jsxs("div",{className:"border border-border rounded-xl overflow-hidden w-full",children:[e.jsxs("div",{className:"bg-secondary/20 px-3 py-2 border-b border-border text-xs font-medium opacity-60 uppercase tracking-wider flex justify-between items-center",children:[e.jsx("span",{children:x==="guitar"?"Guitar":"Piano"}),e.jsxs("span",{className:"truncate max-w-[150px] text-right",children:["sel: ",a.join(", ")||"-"]})]}),e.jsx("div",{className:"p-2 sm:p-4 md:p-8 overflow-x-auto w-full scrollbar-hide",children:e.jsx("div",{className:"min-w-max mx-auto px-4",children:x==="guitar"?e.jsx(Q,{onNoteClick:({note:n})=>m(n),isHideNoteName:y==="hide"}):e.jsx(F,{onNoteClick:({name:n})=>m(n),isHideNoteName:y==="hide"})})})]}),e.jsx("div",{className:"flex flex-wrap justify-center pt-2 pb-8 gap-3 px-2",children:o==="correct"||o==="revealed"?e.jsxs("button",{onClick:S,className:"flex items-center gap-2 px-8 py-4 bg-foreground text-background hover:opacity-90 rounded-xl font-bold transition-all w-full sm:w-auto justify-center shadow-lg",children:[e.jsx("span",{children:"下一題"}),e.jsx("span",{className:"material-icons",style:{fontSize:"18px"},children:"arrow_forward"})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:w,className:"px-4 py-3 rounded-lg font-medium transition-all text-sm bg-secondary/20 text-secondary-foreground hover:bg-secondary/40 flex-1 sm:flex-none",children:"放棄"}),d==="hard"&&e.jsxs("button",{onClick:k,disabled:a.length===0,className:`
                  px-5 py-3 rounded-lg font-medium transition-all flex items-center justify-center gap-2 flex-1 sm:flex-none
                  ${a.length===0?"bg-secondary/30 text-secondary-foreground/50 cursor-not-allowed":"bg-secondary text-secondary-foreground hover:opacity-80"}
                `,title:"播放選取的音符",children:[e.jsx("span",{className:"material-icons",style:{fontSize:"18px"},children:"play_arrow"}),e.jsx("span",{className:"sm:inline",children:"試聽"})]}),e.jsx("button",{onClick:z,disabled:a.length===0,className:`
                px-8 py-3 rounded-lg font-medium transition-all flex-1 sm:flex-none
                ${a.length===0?"bg-secondary text-secondary-foreground opacity-50 cursor-not-allowed":"bg-foreground text-background hover:opacity-90 font-bold shadow-md"}
              `,children:"送出"})]})})]})};export{T as default};
